CREATE INDEX company_index
FOR (n:Company)
ON (n.id);

CREATE INDEX property_index
FOR (n:Tmp)
ON (n.id);

LOAD CSV WITH HEADERS FROM "http://localhost:11001/project-3aa654ee-04b1-4dde-ac3a-8cc527592664/Q30.csv" AS line
MERGE (n:Company {id: line.id})
SET n.name=line.name,
n.start_date=line.start_date

LOAD CSV WITH HEADERS FROM 'http://localhost:11001/project-3aa654ee-04b1-4dde-ac3a-8cc527592664/Q30_prop.csv' AS line
WITH line where line.val_id is not null
MERGE(node0:Company {id : line.company_id})
MERGE(node1:Tmp {id : line.val_id, tmp:line.node_typ})
WITH node0, node1, line
CALL apoc.create.relationship(node0, line.edge_typ, {}, node1) YIELD rel
RETURN 1

MATCH (n:Tmp)
WHERE n.tmp = "Location"
SET n:Location;

MATCH (n:Tmp)
WHERE n.tmp = "Industry"
SET n:Industry;

MATCH (n:Tmp)
WHERE n.tmp = "Person"
SET n:Person;

MATCH (n:Tmp)
WHERE n.tmp = "Group"
SET n:Group;

MATCH (n:Tmp)
WHERE n.tmp = "Quant_Metric"
SET n:Quant_Metric;

LOAD CSV WITH HEADERS FROM "http://localhost:11001/project-3aa654ee-04b1-4dde-ac3a-8cc527592664/Q30_edge.csv" AS line  with line where line.owned_id is not null and line.owner_id is not null
MATCH (owned:Company {id: line.owned_id})
MATCH (owner:Company {id: line.owner_id})
MERGE (owner)-[:ACQUIRED]->(owned);

match ()-[r]->() 
match (s)-[r]->(e) 
with s,e,type(r) as typ, tail(collect(r)) as coll 
foreach(x in coll | delete x)


MATCH (n)-[r]->(c) RETURN *
